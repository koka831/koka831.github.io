<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="theme-color" content="#ddd4bb"/><meta property="og:type" content="website"/><meta property="og:url" content="https://koka831.github.io"/><meta property="og:site_name" content="/var/log/koka"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="/var/log/koka"/><meta name="twitter:site" content="@k_0ka"/><meta name="twitter:description" content="cat /var/log/koka &gt; /dev/null"/><link rel="alternate" type="application/rss+xml" href="https://koka831.github.io/feed.xml" title="/var/log/koka RSS2.0"/><title>Install Arch Linux | /var/log/koka</title><meta property="title" content="Install Arch Linux | /var/log/koka"/><meta property="og:title" content="Install Arch Linux | /var/log/koka"/><meta property="twitter:title" content="Install Arch Linux | /var/log/koka"/><meta property="description" content="log"/><meta property="og:description" content="log"/><meta property="twitter:description" content="log"/><meta property="og:image" content="https://koka831.github.io/img/icon.png"/><meta name="next-head-count" content="19"/><link rel="preload" href="/_next/static/css/55d5df5355c8116d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/55d5df5355c8116d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/91a87cd7c252ab33.css" as="style"/><link rel="stylesheet" href="/_next/static/css/91a87cd7c252ab33.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-a054bbf31fb90f6a.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e0fcf5a3a528e4c5.js" defer=""></script><script src="/_next/static/chunks/cb1608f2-ecfb8d9b659208e2.js" defer=""></script><script src="/_next/static/chunks/956-add503b49f004141.js" defer=""></script><script src="/_next/static/chunks/291-6b2ab5605142007f.js" defer=""></script><script src="/_next/static/chunks/pages/archives/%5Bslug%5D-f3c25ca7c16881be.js" defer=""></script><script src="/_next/static/znmYoLexqSmMsB-BwArHq/_buildManifest.js" defer=""></script><script src="/_next/static/znmYoLexqSmMsB-BwArHq/_ssgManifest.js" defer=""></script><script src="/_next/static/znmYoLexqSmMsB-BwArHq/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><nav class="Header_navigation__container__Xjar7"><div class="Header_navigation__qZpeO"><a href="/">/var/log/koka</a></div><div><a href="/archives">archive</a></div></nav><main class="Layout_container__LBFOo"><div class="slug_container__f_fjw"><div class="slug_main__WMOpC"><article class="slug_article__cOl2p" role="article"><div itemscope="" class="ArticleHeader_header__container__5Gs_X"><a class="ArticleHeader_post__title__gVFje" href="/archives/2020-06-05-install-arch-linux">Install Arch Linux</a><p>log</p><div class="ArticleHeader_flex__yDiMS"><div class="ArticleHeader_post__tags__uCQyx"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="tags" class="svg-inline--fa fa-tags ArticleHeader_tags__icon__U9c_O" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M472.8 168.4C525.1 221.4 525.1 306.6 472.8 359.6L360.8 472.9C351.5 482.3 336.3 482.4 326.9 473.1C317.4 463.8 317.4 448.6 326.7 439.1L438.6 325.9C472.5 291.6 472.5 236.4 438.6 202.1L310.9 72.87C301.5 63.44 301.6 48.25 311.1 38.93C320.5 29.61 335.7 29.7 344.1 39.13L472.8 168.4zM.0003 229.5V80C.0003 53.49 21.49 32 48 32H197.5C214.5 32 230.7 38.74 242.7 50.75L410.7 218.7C435.7 243.7 435.7 284.3 410.7 309.3L277.3 442.7C252.3 467.7 211.7 467.7 186.7 442.7L18.75 274.7C6.743 262.7 0 246.5 0 229.5L.0003 229.5zM112 112C94.33 112 80 126.3 80 144C80 161.7 94.33 176 112 176C129.7 176 144 161.7 144 144C144 126.3 129.7 112 112 112z"></path></svg><p class="Tag_tag__rl8WL">Linux</p></div><div class="ArticleHeader_post__dates__6uEwt"><time dateTime="2020-06-05" itemProp="datePublished" class="PublishDate_post__date__jhH_w">published: <!-- -->2020-06-05</time><time dateTime="2021-10-13" itemProp="datePublished" class="PublishDate_post__date__jhH_w">updated: 2021-10-13</time></div></div></div><div class="slug_article__body__m2pRS"><h2 id="0-partition-table"><a href="#0-partition-table">0. Partition Table</a></h2>
<p>インストール先のディスク名を調べる.</p>
<div class="remark-highlight"><pre data-file="terminal" class="language-shell-session"><code class="language-shell-session"><span class="token output">$fdisk -l</span>
<span class="token output">bar</span>
</code></pre></div>
<h2 id="1-reset-partition"><a href="#1-reset-partition">1. Reset Partition</a></h2>
<ul>
<li>cgdisk/sgdiskを使う
<ul>
<li>cgdiskがcursesベースなので使いやすい</li>
</ul>
</li>
</ul>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">cgdisk /dev/nvme0n1</span></span>
</code></pre></div>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">ls</span> -la</span></span>
</code></pre></div>
<p>最低限必要なpartitionは以下の3つ.</p>
<ul>
<li>/boot/efi: EFI</li>
<li>/boot    : Linux FS</li>
<li>/ (root) : Linux FS</li>
</ul>
<p>ブートセクタの開始領域がEFIになっている必要があるので、上から順に設定していく.
/boot/efiが/bootに入れ子になっているが, mount時に調整する.</p>
<h3 id="efi-partition"><a href="#efi-partition">EFI partition</a></h3>
<ul>
<li>/boot/efi partition
<ul>
<li>First Sector: Enter(default)</li>
<li>Size in sectors: 512M</li>
<li>Hex code or GUID: ef00</li>
<li>Enter new partition name: EFI System</li>
</ul>
</li>
</ul>
<h3 id="boot-partition"><a href="#boot-partition">boot partition</a></h3>
<ul>
<li>/boot
<ul>
<li>First Sector: Enter(default)</li>
<li>Size: 512M</li>
<li>Hex: 8300</li>
<li>Enter new partition name: Linux filesystem</li>
</ul>
</li>
</ul>
<h3 id="root-partition"><a href="#root-partition">root partition</a></h3>
<ul>
<li>/
<ul>
<li>First Sector: Enter(default)</li>
<li>Size: Enter(default=max)</li>
<li>Hex: 8300</li>
<li>Enter new partition name: Linux filesystem</li>
</ul>
</li>
</ul>
<h3 id="result-of-partitioning"><a href="#result-of-partitioning">Result of partitioning</a></h3>
<ul>
<li>512G SSDを対象に行うと以下のようになる.</li>
</ul>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">fdisk</span> -l</span></span>
<span class="token output">Device          Start   End             Sectors Size    Type</span>
<span class="token output">/dev/nvme0n1p1  2048    1050623         1048576 512M    Efi system</span>
<span class="token output">/dev/nvme0n1p2 1050624  2099199         1048576 512M    Linux filesystem</span>
<span class="token output">/dev/nvme0n1p3  2099200 1000215182    998115983 476G    Linux filesystem</span>
</code></pre></div>
<h2 id="2-disk-format"><a href="#2-disk-format">2. Disk Format</a></h2>
<p>mkfsを用いて各partitionをフォーマットする.<br>
efi領域はFAT32指定、その他Linux filesystemの領域はext4等好みのファイルシステムを用いる.</p>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">mkfs.fat -F32 /dev/nvme0n1p1</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">mkfs.ext4 /dev/nvme0n1p2</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">mkfs.ext4 /dev/nvme0n1p3</span></span>
</code></pre></div>
<h2 id="3-mount-volume"><a href="#3-mount-volume">3. Mount Volume</a></h2>
<p>1, 2で作成したpartitionをboot USBからアクセスできるようにマウントする.
1.で行ったパーティショニングとマウントの順番が異なるので注意(1敗).</p>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">/root</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">mount</span> /dev/nvme0n1p3 /mnt</span></span>

<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">/boot</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">mkdir</span> /mnt/boot</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">mount</span> /dev/nvme0n1p2 /mnt/boot</span></span>

<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">/boot/efi</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">mkdir</span> /mnt/boot/efi</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">mount</span> /dev/nvme0n1p1 /mnt/boot/efi</span></span>
</code></pre></div>
<h2 id="4-install-linux-system"><a href="#4-install-linux-system">4. Install Linux system</a></h2>
<h3 id="setup-repository-mirror"><a href="#setup-repository-mirror">Setup repository mirror</a></h3>
<p><code>/etc/pacman.d/mirrorlist</code>を編集し現在位置から距離の近いミラーを一番上にもってくる.</p>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">vim</span> /etc/pacman.d/mirrorlist</span></span>
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">use mirror <span class="token keyword">in</span> Japan</span></span>
</code></pre></div>
<h3 id="install-base-system"><a href="#install-base-system">Install base system</a></h3>
<p>マウントした<code>/root</code>に対してLinuxやその後の作業に必要な諸々をインストールする.
後述する5.1でマウント領域に<code>chroot</code>したあとはboot USB内のデフォルトツール類が使えなくなるので, エディタはここでインストールしておく.</p>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">linux base system</span></span>
<span class="token output">pacstrap /mnt base linux linux-firmware</span>
<span class="token output"></span><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash"><span class="token keyword">for</span> wifi</span></span>
<span class="token output">pacstrap /mnt base-devel grub efibootmgr dosfstools netctl iw wpa_supplicant networkmanager dialog vim</span>
</code></pre></div>
<h3 id="generate-fstab-file"><a href="#generate-fstab-file">generate fstab file</a></h3>
<div class="remark-highlight"><pre class="language-sh"><code class="language-sh">genfstab -U /mnt &#x26;gt;&#x26;gt; /mnt/etc/fstab</code></pre></div>
<h3 id="check-filesystem"><a href="#check-filesystem">check filesystem</a></h3>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">cat</span> /mnt/etc/fstab</span></span>
<span class="token output">/dev/nvme0n1p3 /         ext4 rw,relatime 0 1</span>
<span class="token output">/dev/nvme0n1p2 /boot     ext4 rw,relatime 0 2</span>
<span class="token output">/dev/nvme0n1p1 /boot/efi vfat rw,relatime,fmask=0022,codepage=... 0 2</span>
</code></pre></div>
<h2 id="5-enter-arch"><a href="#5-enter-arch">5 enter arch!</a></h2>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token output">arch-chroot /mnt /bin/bash</span>
</code></pre></div>
<h3 id="setup-localetimezone"><a href="#setup-localetimezone">Setup locale/timezone</a></h3>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">locale</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">vim</span> /etc/locale.gen</span></span>
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">uncomment en_US.UTF-8 and ja_JP.UTF-8</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">locale-gen</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"LANG=en_US.UTF-8"</span> <span class="token operator">></span> /etc/locale.conf</span></span>

<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">timezone</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">tzselect <span class="token number">4</span>, <span class="token number">19</span>, <span class="token number">1</span></span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">hwclock --systohc --utc</span></span>
</code></pre></div>
<h3 id="setup-bootloader"><a href="#setup-bootloader">Setup bootloader</a></h3>
<p>bootloaderの作成.</p>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">mkinitcpio -p linux</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">grub-install --target<span class="token operator">=</span>x86_64-efi --efi-directory<span class="token operator">=</span>/boot/efi --bootloader-id<span class="token operator">=</span>arch --boot-directory<span class="token operator">=</span>/boot/efi/EFI --recheck</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">grub-mkconfig</span> -o /boot/efi/EFI/grub/grub.cfg</span></span>
</code></pre></div>
<h3 id="change-root-password--add-user"><a href="#change-root-password--add-user">Change Root password &#x26; add User</a></h3>
<p>5.4にてリブートする前にユーザを作成しておく(1敗).</p>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">passwd</span></span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">useradd</span> -m -g <span class="token function">users</span> -G wheel -s /bin/bash koka</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">passwd</span> koka</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">visudo <span class="token comment"># and uncomment %Wheel all=(all) all</span></span></span>
</code></pre></div>
<h3 id="reboot--eject-usb"><a href="#reboot--eject-usb">Reboot &#x26; eject USB</a></h3>
<p>シャットダウンしてbootUSBを取り外し再起動する</p>
<h2 id="6-setup-arch-linux"><a href="#6-setup-arch-linux">6. Setup Arch Linux</a></h2>
<h3 id="network"><a href="#network">network</a></h3>
<p>wifiの設定.
<code>nmtui</code>が好きなのでNetworkManagerを用いた.
セットアップ後の開発において<code>systemd-nspawn</code>を使う場合, ネットワークアダプタは<code>systemd-networkd</code>なのでそっちの場合は<code>systemd</code>に統一しといたほうが後々楽.</p>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">systemctl start NetworkManager</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">systemctl <span class="token builtin class-name">enable</span> NetworkManager</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">nmtui</span></span>
</code></pre></div>
<h3 id="setup-x-window-system"><a href="#setup-x-window-system">Setup X Window System</a></h3>
<p><a href="https://wiki.archlinux.jp/index.php/Xorg" target="_blank" rel="nofollow noopener noreferrer">ref</a>
CUIからGUIへ.</p>
<div class="remark-highlight"><pre class="language-shell-session"><code class="language-shell-session"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">lspci <span class="token operator">|</span> <span class="token function">grep</span> -e VGA -e 3D</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token comment"># XとDMとしてlight DM(とログイン画面)をインストール</span></span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">pacman -S xf86-video-intel xorg-server xorg-xrdb lightdm lightdm-gtk-greeter</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token comment"># terminal emulatorも入ってないので何かしらいれとく(1敗)</span></span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">pacman -S rxvt-unicode</span></span>

<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">systemctl <span class="token builtin class-name">enable</span> lightdm</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token comment"># WMをインストール</span></span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">pacman -S i3-gaps i3status dmenu</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token comment"># tlp/バッテリ最適化モジュール</span></span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">pacman -S tlp</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token comment"># フォント</span></span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token comment"># ブラウザやアプリはデフォだとシステム設定のフォント読まずに表示が汚くなるので、</span></span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token comment"># デフォ指定に含まれているttf-dejavuを入れとく(Ubuntuのデフォフォント).</span></span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">pacman -S ttf-fira-code oft-ipamjfont ttf-dejavu</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">pacman -S xorg-xbacklight <span class="token comment"># 画面の明るさ</span></span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">pacman -S pulseaudio-alsa alsa-utils alsa-plugins <span class="token comment"># 音量</span></span></span>
</code></pre></div></div></article><div class="CommitLogs_commit_logs__W6xPi" role="log"><h2>Commits</h2><details><summary><span class="CommitLogs_commit__date___q8bm">2021-10-13 23:48:16</span><span class="CommitLogs_commit__hash__Xyu7v">fc674d6b</span><span class="CommitLogs_commit__message__IGUPv">fix some</span></summary><div><div class="remark-highlight"><pre data-file="fc674d6b.patch" class="language-git  language-diff"><code class="language-git"><span class="token commit-sha1">commit fc674d6b05dbbc38f77579f9120500b8c4a81926</span>
Author: koka &#x26;<a href="mailto:lt;koka.code@gmail.com" class="token email-link">lt;koka.code@gmail.com</a>&#x26;gt;
Date:   Wed Oct 13 23:48:16 2021 +0900

  fix some

diff --git a/_posts/2020-06-05-install-arch-linux.md b/_posts/2020-06-05-install-arch-linux.md
index f71dd06..1e2b358 100644
<span class="token deleted">--- a/_posts/2020-06-05-install-arch-linux.md</span>
<span class="token inserted">+++ b/_posts/2020-06-05-install-arch-linux.md</span>
@@ -21,20 +21,7 @@ bar
   - cgdiskがcursesベースなので使いやすい

\```shell-session
<span class="token deleted">-$echo $EDITOR</span>
<span class="token deleted">-vim</span>
<span class="token deleted">-$git checkout master</span>
<span class="token deleted">-Switched to branch 'master'</span>
<span class="token deleted">-Your branch is up-to-date with 'origin/master'</span>
<span class="token deleted">-#foo</span>
<span class="token deleted">-$git push</span>
<span class="token deleted">-Everything up-to-date</span>
<span class="token deleted">-[sudo] password for koka:</span>
<span class="token deleted">-$echo 'All</span>
<span class="token deleted">-&#x26;gt; done!'</span>
<span class="token deleted">-All</span>
<span class="token deleted">-done!</span>
<span class="token deleted">-$cgdisk /dev/nvme0n1</span>
<span class="token inserted">+$ cgdisk /dev/nvme0n1</span>
\```

\```shell-session
@@ -78,7 +65,7 @@ $ ls -la
<span class="token comment">### Result of partitioning</span>
<span class="token deleted">- 512G SSDを対象に行うと以下のようになる.</span>

<span class="token deleted">-\```sh</span>
<span class="token inserted">+\```shell-session</span>
$ fdisk -l
Device          Start   End             Sectors Size    Type
/dev/nvme0n1p1  2048    1050623         1048576 512M    Efi system
@@ -90,10 +77,10 @@ Device          Start   End             Sectors Size    Type
mkfsを用いて各partitionをフォーマットする.  
efi領域はFAT32指定、その他Linux filesystemの領域はext4等好みのファイルシステムを用いる.

<span class="token deleted">-\```sh</span>
<span class="token deleted">-mkfs.fat -F32 /dev/nvme0n1p1</span>
<span class="token deleted">-mkfs.ext4 /dev/nvme0n1p2</span>
<span class="token deleted">-mkfs.ext4 /dev/nvme0n1p3</span>
<span class="token inserted">+\```shell-session</span>
<span class="token inserted">+$ mkfs.fat -F32 /dev/nvme0n1p1</span>
<span class="token inserted">+$ mkfs.ext4 /dev/nvme0n1p2</span>
<span class="token inserted">+$ mkfs.ext4 /dev/nvme0n1p3</span>
\```

<span class="token comment">## 3. Mount Volume</span>
</code></pre></div></div></details><details><summary><span class="CommitLogs_commit__date___q8bm">2021-04-25 14:18:15</span><span class="CommitLogs_commit__hash__Xyu7v">dae19db3</span><span class="CommitLogs_commit__message__IGUPv">fix</span></summary><div><div class="remark-highlight"><pre data-file="dae19db3.patch" class="language-git  language-diff"><code class="language-git"><span class="token commit-sha1">commit dae19db337b318bfe27a5713113f2e56341e0b2e</span>
Author: koka &#x26;<a href="mailto:lt;koka.code@gmail.com" class="token email-link">lt;koka.code@gmail.com</a>&#x26;gt;
Date:   Sun Apr 25 14:18:15 2021 +0900

  fix

diff --git a/_posts/2020-06-05-install-arch-linux.md b/_posts/2020-06-05-install-arch-linux.md
index 0bff7c6..f71dd06 100644
<span class="token deleted">--- a/_posts/2020-06-05-install-arch-linux.md</span>
<span class="token inserted">+++ b/_posts/2020-06-05-install-arch-linux.md</span>
@@ -16,13 +16,6 @@ $fdisk -l
bar
\```

<span class="token deleted">-[[info | custom container]]</span>
<span class="token deleted">-| content</span>
<span class="token deleted">-| bar</span>
<span class="token deleted">-</span>
<span class="token deleted">-</span>
<span class="token deleted">-multi line</span>
<span class="token deleted">-</span>
<span class="token comment">## 1. Reset Partition</span>
<span class="token deleted">- cgdisk/sgdiskを使う</span>
   - cgdiskがcursesベースなので使いやすい
</code></pre></div></div></details><details><summary><span class="CommitLogs_commit__date___q8bm">2021-03-05 18:48:41</span><span class="CommitLogs_commit__hash__Xyu7v">70a0aff5</span><span class="CommitLogs_commit__message__IGUPv">wip</span></summary><div><div class="remark-highlight"><pre data-file="70a0aff5.patch" class="language-git  language-diff"><code class="language-git"><span class="token commit-sha1">commit 70a0aff5a83d4332a8c3ccff3d2d3c1c84e46ef2</span>
Author: koka &#x26;<a href="mailto:lt;koka.code@gmail.com" class="token email-link">lt;koka.code@gmail.com</a>&#x26;gt;
Date:   Fri Mar 5 18:48:41 2021 +0900

  wip

diff --git a/_posts/2020-06-05-install-arch-linux.md b/_posts/2020-06-05-install-arch-linux.md
index f71dd06..0bff7c6 100644
<span class="token deleted">--- a/_posts/2020-06-05-install-arch-linux.md</span>
<span class="token inserted">+++ b/_posts/2020-06-05-install-arch-linux.md</span>
@@ -16,6 +16,13 @@ $fdisk -l
bar
\```

<span class="token inserted">+[[info | custom container]]</span>
<span class="token inserted">+| content</span>
<span class="token inserted">+| bar</span>
<span class="token inserted">+</span>
<span class="token inserted">+</span>
<span class="token inserted">+multi line</span>
<span class="token inserted">+</span>
<span class="token comment">## 1. Reset Partition</span>
<span class="token deleted">- cgdisk/sgdiskを使う</span>
   - cgdiskがcursesベースなので使いやすい
</code></pre></div></div></details><details><summary><span class="CommitLogs_commit__date___q8bm">2021-02-15 00:34:10</span><span class="CommitLogs_commit__hash__Xyu7v">bd59f09a</span><span class="CommitLogs_commit__message__IGUPv">update</span></summary><div><div class="remark-highlight"><pre data-file="bd59f09a.patch" class="language-git  language-diff"><code class="language-git"><span class="token commit-sha1">commit bd59f09a33181a1f762978251b6b4d7eb0095a09</span>
Author: koka &#x26;<a href="mailto:lt;koka.code@gmail.com" class="token email-link">lt;koka.code@gmail.com</a>&#x26;gt;
Date:   Mon Feb 15 00:34:10 2021 +0900

  update

diff --git a/_posts/2020-06-05-install-arch-linux.md b/_posts/2020-06-05-install-arch-linux.md
index 30bf785..f71dd06 100644
<span class="token deleted">--- a/_posts/2020-06-05-install-arch-linux.md</span>
<span class="token inserted">+++ b/_posts/2020-06-05-install-arch-linux.md</span>
@@ -11,16 +11,34 @@ description: log
<span class="token comment">## 0. Partition Table</span>
インストール先のディスク名を調べる.

<span class="token deleted">-\```sh</span>
<span class="token deleted">-fdisk -l</span>
<span class="token inserted">+\```shell-session[data-file="terminal"]</span>
<span class="token inserted">+$fdisk -l</span>
<span class="token inserted">+bar</span>
\```

<span class="token comment">## 1. Reset Partition</span>
<span class="token deleted">- cgdisk/sgdiskを使う</span>
   - cgdiskがcursesベースなので使いやすい

<span class="token deleted">-\```sh</span>
<span class="token deleted">-cgdisk /dev/nvme0n1</span>
<span class="token inserted">+\```shell-session</span>
<span class="token inserted">+$echo $EDITOR</span>
<span class="token inserted">+vim</span>
<span class="token inserted">+$git checkout master</span>
<span class="token inserted">+Switched to branch 'master'</span>
<span class="token inserted">+Your branch is up-to-date with 'origin/master'</span>
<span class="token inserted">+#foo</span>
<span class="token inserted">+$git push</span>
<span class="token inserted">+Everything up-to-date</span>
<span class="token inserted">+[sudo] password for koka:</span>
<span class="token inserted">+$echo 'All</span>
<span class="token inserted">+&#x26;gt; done!'</span>
<span class="token inserted">+All</span>
<span class="token inserted">+done!</span>
<span class="token inserted">+$cgdisk /dev/nvme0n1</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```shell-session</span>
<span class="token inserted">+$ ls -la</span>
\```

最低限必要なpartitionは以下の3つ. 
@@ -32,7 +50,7 @@ cgdisk /dev/nvme0n1
ブートセクタの開始領域がEFIになっている必要があるので、上から順に設定していく.
/boot/efiが/bootに入れ子になっているが, mount時に調整する.

<span class="token deleted">-### 1.1 EFI partition</span>
<span class="token inserted">+### EFI partition</span>

<span class="token deleted">- /boot/efi partition</span>
   - First Sector: Enter(default)
@@ -40,7 +58,7 @@ cgdisk /dev/nvme0n1
   - Hex code or GUID: ef00
   - Enter new partition name: EFI System

<span class="token deleted">-### 1.2 boot partition</span>
<span class="token inserted">+### boot partition</span>

<span class="token deleted">- /boot</span>
   - First Sector: Enter(default)
@@ -48,7 +66,7 @@ cgdisk /dev/nvme0n1
   - Hex: 8300
   - Enter new partition name: Linux filesystem

<span class="token deleted">-### 1.3 root partition</span>
<span class="token inserted">+### root partition</span>

<span class="token deleted">- /</span>
   - First Sector: Enter(default)
@@ -57,7 +75,7 @@ cgdisk /dev/nvme0n1
   - Enter new partition name: Linux filesystem


<span class="token deleted">-### 1.4 Result of partitioning</span>
<span class="token inserted">+### Result of partitioning</span>
<span class="token deleted">- 512G SSDを対象に行うと以下のようになる.</span>

\```sh
@@ -82,53 +100,52 @@ mkfs.ext4 /dev/nvme0n1p3
1, 2で作成したpartitionをboot USBからアクセスできるようにマウントする.
1.で行ったパーティショニングとマウントの順番が異なるので注意(1敗).

<span class="token deleted">-\```sh</span>
<span class="token inserted">+\```shell-session</span>
<span class="token comment"># /root</span>
<span class="token deleted">-mount /dev/nvme0n1p3 /mnt</span>
<span class="token inserted">+$ mount /dev/nvme0n1p3 /mnt</span>

<span class="token comment"># /boot</span>
<span class="token deleted">-mkdir /mnt/boot</span>
<span class="token deleted">-mount /dev/nvme0n1p2 /mnt/boot</span>
<span class="token inserted">+$ mkdir /mnt/boot</span>
<span class="token inserted">+$ mount /dev/nvme0n1p2 /mnt/boot</span>

<span class="token comment"># /boot/efi</span>
<span class="token deleted">-mkdir /mnt/boot/efi</span>
<span class="token deleted">-mount /dev/nvme0n1p1 /mnt/boot/efi</span>
<span class="token inserted">+$ mkdir /mnt/boot/efi</span>
<span class="token inserted">+$ mount /dev/nvme0n1p1 /mnt/boot/efi</span>
\```

<span class="token comment">## 4. Install Linux system</span>

<span class="token deleted">-### 4.1 Setup repository mirror</span>
<span class="token inserted">+### Setup repository mirror</span>
`/etc/pacman.d/mirrorlist`を編集し現在位置から距離の近いミラーを一番上にもってくる.

<span class="token deleted">-\```sh</span>
<span class="token deleted">-vim /etc/pacman.d/mirrorlist</span>
<span class="token inserted">+\```shell-session</span>
<span class="token inserted">+$ vim /etc/pacman.d/mirrorlist</span>
<span class="token comment"># use mirror in Japan</span>
\```


<span class="token deleted">-### 4.2 Install base system</span>
<span class="token inserted">+### Install base system</span>
マウントした`/root`に対してLinuxやその後の作業に必要な諸々をインストールする.
後述する5.1でマウント領域に`chroot`したあとはboot USB内のデフォルトツール類が使えなくなるので, エディタはここでインストールしておく.


<span class="token deleted">-\```sh</span>
<span class="token inserted">+\```shell-session</span>
<span class="token comment"># linux base system</span>
pacstrap /mnt base linux linux-firmware
<span class="token comment"># for wifi</span>
pacstrap /mnt base-devel grub efibootmgr dosfstools netctl iw wpa_supplicant networkmanager dialog vim
\```

<span class="token deleted">-### 4.3 generate fstab file</span>
<span class="token inserted">+### generate fstab file</span>

\```sh
genfstab -U /mnt &#x26;gt;&#x26;gt; /mnt/etc/fstab
\```

<span class="token deleted">-### 4.4 check filesystem</span>
<span class="token inserted">+### check filesystem</span>

<span class="token deleted">-\```sh</span>
<span class="token inserted">+\```shell-session</span>
$ cat /mnt/etc/fstab
<span class="token deleted">-</span>
/dev/nvme0n1p3 /         ext4 rw,relatime 0 1
/dev/nvme0n1p2 /boot     ext4 rw,relatime 0 2
/dev/nvme0n1p1 /boot/efi vfat rw,relatime,fmask=0022,codepage=... 0 2
@@ -137,13 +154,13 @@ $ cat /mnt/etc/fstab

<span class="token comment">## 5 enter arch!</span>

<span class="token deleted">-\```sh</span>
<span class="token inserted">+\```shell-session</span>
arch-chroot /mnt /bin/bash
\```

<span class="token deleted">-### 5.1 Setup locale/timezone</span>
<span class="token inserted">+### Setup locale/timezone</span>

<span class="token deleted">-\```sh</span>
<span class="token inserted">+\```shell-session</span>
<span class="token comment"># locale</span>
$ vim /etc/locale.gen
<span class="token comment"># uncomment en_US.UTF-8 and ja_JP.UTF-8</span>
@@ -155,62 +172,60 @@ $ tzselect 4, 19, 1
$ hwclock --systohc --utc
\```

<span class="token deleted">-### 5.2 Setup bootloader</span>
<span class="token inserted">+### Setup bootloader</span>
bootloaderの作成.

<span class="token deleted">-\```sh</span>
<span class="token inserted">+\```shell-session</span>
$ mkinitcpio -p linux
$ grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=arch --boot-directory=/boot/efi/EFI --recheck
$ grub-mkconfig -o /boot/efi/EFI/grub/grub.cfg
\```

<span class="token deleted">-### 5.3 Change Root password &#x26; add User</span>
<span class="token inserted">+### Change Root password &#x26; add User</span>
5.4にてリブートする前にユーザを作成しておく(1敗).

<span class="token deleted">-\```sh</span>
<span class="token inserted">+\```shell-session</span>
$ passwd
$ useradd -m -g users -G wheel -s /bin/bash koka
$ passwd koka
$ visudo # and uncomment %Wheel all=(all) all
\```
<span class="token deleted">-### 5.4 Reboot &#x26; eject USB</span>
<span class="token inserted">+### Reboot &#x26; eject USB</span>
シャットダウンしてbootUSBを取り外し再起動する

<span class="token comment">## 6. Setup Arch Linux</span>

<span class="token deleted">-### 6.1 network</span>
<span class="token inserted">+### network</span>
wifiの設定.
`nmtui`が好きなのでNetworkManagerを用いた.
セットアップ後の開発において`systemd-nspawn`を使う場合, ネットワークアダプタは`systemd-networkd`なのでそっちの場合は`systemd`に統一しといたほうが後々楽.

<span class="token deleted">-\```sh</span>
<span class="token inserted">+\```shell-session</span>
$ systemctl start NetworkManager
$ systemctl enable NetworkManager
$ nmtui
\```

<span class="token deleted">-### 6.2 Setup X Window System</span>
<span class="token inserted">+### Setup X Window System</span>
[ref](<a href="https://wiki.archlinux.jp/index.php/Xorg" class="token url-link">https://wiki.archlinux.jp/index.php/Xorg</a>)
CUIからGUIへ.

<span class="token deleted">-\```sh</span>
<span class="token inserted">+\```shell-session</span>
$ lspci | grep -e VGA -e 3D
<span class="token deleted">-# XとDMとしてlight DM(とログイン画面)をインストール</span>
<span class="token inserted">+$ # XとDMとしてlight DM(とログイン画面)をインストール</span>
$ pacman -S xf86-video-intel xorg-server xorg-xrdb lightdm lightdm-gtk-greeter
<span class="token deleted">-# terminal emulatorも入ってないので何かしらいれとく(1敗)</span>
<span class="token inserted">+$ # terminal emulatorも入ってないので何かしらいれとく(1敗)</span>
$ pacman -S rxvt-unicode
<span class="token deleted">-# </span>
<span class="token inserted">+</span>
$ systemctl enable lightdm
<span class="token deleted">-# WMをインストール</span>
<span class="token inserted">+$ # WMをインストール</span>
$ pacman -S i3-gaps i3status dmenu
<span class="token deleted">-# tlp/バッテリ最適化モジュール</span>
<span class="token inserted">+$ # tlp/バッテリ最適化モジュール</span>
$ pacman -S tlp
<span class="token deleted">-# フォント</span>
<span class="token deleted">-# ブラウザやアプリはデフォだとシステム設定のフォント読まずに表示が汚くなるので、</span>
<span class="token deleted">-# デフォ指定に含まれているttf-dejavuを入れとく(Ubuntuのデフォフォント).</span>
<span class="token inserted">+$ # フォント</span>
<span class="token inserted">+$ # ブラウザやアプリはデフォだとシステム設定のフォント読まずに表示が汚くなるので、</span>
<span class="token inserted">+$ # デフォ指定に含まれているttf-dejavuを入れとく(Ubuntuのデフォフォント).</span>
$ pacman -S ttf-fira-code oft-ipamjfont ttf-dejavu
<span class="token deleted">-# 画面の明るさ</span>
<span class="token deleted">-$ pacman -S xorg-xbacklight</span>
<span class="token deleted">-# 音量</span>
<span class="token deleted">-$ pacman -S pulseaudio-alsa alsa-utils alsa-plugins</span>
<span class="token inserted">+$ pacman -S xorg-xbacklight # 画面の明るさ</span>
<span class="token inserted">+$ pacman -S pulseaudio-alsa alsa-utils alsa-plugins # 音量</span>
\```
</code></pre></div></div></details><details><summary><span class="CommitLogs_commit__date___q8bm">2021-01-30 22:18:17</span><span class="CommitLogs_commit__hash__Xyu7v">35b550ae</span><span class="CommitLogs_commit__message__IGUPv">copy md</span></summary><div><div class="remark-highlight"><pre data-file="35b550ae.patch" class="language-git  language-diff"><code class="language-git"><span class="token commit-sha1">commit 35b550ae83af4efaeadf33471c8ca8a32c1079c8</span>
Author: koka &#x26;<a href="mailto:lt;koka.code@gmail.com" class="token email-link">lt;koka.code@gmail.com</a>&#x26;gt;
Date:   Sat Jan 30 22:18:17 2021 +0900

  copy md

diff --git a/_posts/2020-06-05-install-arch-linux.md b/_posts/2020-06-05-install-arch-linux.md
new file mode 100644
index 0000000..30bf785
<span class="token deleted">--- /dev/null</span>
<span class="token inserted">+++ b/_posts/2020-06-05-install-arch-linux.md</span>
<span class="token coord">@@ -0,0 +1,216 @@</span>
<span class="token inserted">+---</span>
<span class="token inserted">+title: 'Install Arch Linux'</span>
<span class="token inserted">+date: 2020-06-05</span>
<span class="token inserted">+categories:</span>
<span class="token inserted">+- Diary</span>
<span class="token inserted">+tags:</span>
<span class="token inserted">+- Linux</span>
<span class="token inserted">+description: log</span>
<span class="token inserted">+---</span>
<span class="token inserted">+</span>
<span class="token inserted">+## 0. Partition Table</span>
<span class="token inserted">+インストール先のディスク名を調べる.</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+fdisk -l</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+## 1. Reset Partition</span>
<span class="token inserted">+- cgdisk/sgdiskを使う</span>
<span class="token inserted">+    - cgdiskがcursesベースなので使いやすい</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+cgdisk /dev/nvme0n1</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+最低限必要なpartitionは以下の3つ. </span>
<span class="token inserted">+</span>
<span class="token inserted">+- /boot/efi: EFI</span>
<span class="token inserted">+- /boot    : Linux FS</span>
<span class="token inserted">+- / (root) : Linux FS</span>
<span class="token inserted">+</span>
<span class="token inserted">+ブートセクタの開始領域がEFIになっている必要があるので、上から順に設定していく.</span>
<span class="token inserted">+/boot/efiが/bootに入れ子になっているが, mount時に調整する.</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 1.1 EFI partition</span>
<span class="token inserted">+</span>
<span class="token inserted">+- /boot/efi partition</span>
<span class="token inserted">+    - First Sector: Enter(default)</span>
<span class="token inserted">+    - Size in sectors: 512M</span>
<span class="token inserted">+    - Hex code or GUID: ef00</span>
<span class="token inserted">+    - Enter new partition name: EFI System</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 1.2 boot partition</span>
<span class="token inserted">+</span>
<span class="token inserted">+- /boot</span>
<span class="token inserted">+    - First Sector: Enter(default)</span>
<span class="token inserted">+    - Size: 512M</span>
<span class="token inserted">+    - Hex: 8300</span>
<span class="token inserted">+    - Enter new partition name: Linux filesystem</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 1.3 root partition</span>
<span class="token inserted">+</span>
<span class="token inserted">+- /</span>
<span class="token inserted">+    - First Sector: Enter(default)</span>
<span class="token inserted">+    - Size: Enter(default=max)</span>
<span class="token inserted">+    - Hex: 8300</span>
<span class="token inserted">+    - Enter new partition name: Linux filesystem</span>
<span class="token inserted">+</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 1.4 Result of partitioning</span>
<span class="token inserted">+- 512G SSDを対象に行うと以下のようになる.</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+$ fdisk -l</span>
<span class="token inserted">+Device          Start   End             Sectors Size    Type</span>
<span class="token inserted">+/dev/nvme0n1p1  2048    1050623         1048576 512M    Efi system</span>
<span class="token inserted">+/dev/nvme0n1p2 1050624  2099199         1048576 512M    Linux filesystem</span>
<span class="token inserted">+/dev/nvme0n1p3  2099200 1000215182    998115983 476G    Linux filesystem</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+## 2. Disk Format</span>
<span class="token inserted">+mkfsを用いて各partitionをフォーマットする.  </span>
<span class="token inserted">+efi領域はFAT32指定、その他Linux filesystemの領域はext4等好みのファイルシステムを用いる.</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+mkfs.fat -F32 /dev/nvme0n1p1</span>
<span class="token inserted">+mkfs.ext4 /dev/nvme0n1p2</span>
<span class="token inserted">+mkfs.ext4 /dev/nvme0n1p3</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+## 3. Mount Volume</span>
<span class="token inserted">+1, 2で作成したpartitionをboot USBからアクセスできるようにマウントする.</span>
<span class="token inserted">+1.で行ったパーティショニングとマウントの順番が異なるので注意(1敗).</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+# /root</span>
<span class="token inserted">+mount /dev/nvme0n1p3 /mnt</span>
<span class="token inserted">+</span>
<span class="token inserted">+# /boot</span>
<span class="token inserted">+mkdir /mnt/boot</span>
<span class="token inserted">+mount /dev/nvme0n1p2 /mnt/boot</span>
<span class="token inserted">+</span>
<span class="token inserted">+# /boot/efi</span>
<span class="token inserted">+mkdir /mnt/boot/efi</span>
<span class="token inserted">+mount /dev/nvme0n1p1 /mnt/boot/efi</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+## 4. Install Linux system</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 4.1 Setup repository mirror</span>
<span class="token inserted">+`/etc/pacman.d/mirrorlist`を編集し現在位置から距離の近いミラーを一番上にもってくる.</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+vim /etc/pacman.d/mirrorlist</span>
<span class="token inserted">+# use mirror in Japan</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 4.2 Install base system</span>
<span class="token inserted">+マウントした`/root`に対してLinuxやその後の作業に必要な諸々をインストールする.</span>
<span class="token inserted">+後述する5.1でマウント領域に`chroot`したあとはboot USB内のデフォルトツール類が使えなくなるので, エディタはここでインストールしておく.</span>
<span class="token inserted">+</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+# linux base system</span>
<span class="token inserted">+pacstrap /mnt base linux linux-firmware</span>
<span class="token inserted">+# for wifi</span>
<span class="token inserted">+pacstrap /mnt base-devel grub efibootmgr dosfstools netctl iw wpa_supplicant networkmanager dialog vim</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 4.3 generate fstab file</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+genfstab -U /mnt &#x26;gt;&#x26;gt; /mnt/etc/fstab</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 4.4 check filesystem</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+$ cat /mnt/etc/fstab</span>
<span class="token inserted">+</span>
<span class="token inserted">+/dev/nvme0n1p3 /         ext4 rw,relatime 0 1</span>
<span class="token inserted">+/dev/nvme0n1p2 /boot     ext4 rw,relatime 0 2</span>
<span class="token inserted">+/dev/nvme0n1p1 /boot/efi vfat rw,relatime,fmask=0022,codepage=... 0 2</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+</span>
<span class="token inserted">+## 5 enter arch!</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+arch-chroot /mnt /bin/bash</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 5.1 Setup locale/timezone</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+# locale</span>
<span class="token inserted">+$ vim /etc/locale.gen</span>
<span class="token inserted">+# uncomment en_US.UTF-8 and ja_JP.UTF-8</span>
<span class="token inserted">+$ locale-gen</span>
<span class="token inserted">+$ echo "LANG=en_US.UTF-8" &#x26;gt; /etc/locale.conf</span>
<span class="token inserted">+</span>
<span class="token inserted">+# timezone</span>
<span class="token inserted">+$ tzselect 4, 19, 1</span>
<span class="token inserted">+$ hwclock --systohc --utc</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 5.2 Setup bootloader</span>
<span class="token inserted">+bootloaderの作成.</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+$ mkinitcpio -p linux</span>
<span class="token inserted">+$ grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=arch --boot-directory=/boot/efi/EFI --recheck</span>
<span class="token inserted">+$ grub-mkconfig -o /boot/efi/EFI/grub/grub.cfg</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 5.3 Change Root password &#x26; add User</span>
<span class="token inserted">+5.4にてリブートする前にユーザを作成しておく(1敗).</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+$ passwd</span>
<span class="token inserted">+$ useradd -m -g users -G wheel -s /bin/bash koka</span>
<span class="token inserted">+$ passwd koka</span>
<span class="token inserted">+$ visudo # and uncomment %Wheel all=(all) all</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+### 5.4 Reboot &#x26; eject USB</span>
<span class="token inserted">+シャットダウンしてbootUSBを取り外し再起動する</span>
<span class="token inserted">+</span>
<span class="token inserted">+## 6. Setup Arch Linux</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 6.1 network</span>
<span class="token inserted">+wifiの設定.</span>
<span class="token inserted">+`nmtui`が好きなのでNetworkManagerを用いた.</span>
<span class="token inserted">+セットアップ後の開発において`systemd-nspawn`を使う場合, ネットワークアダプタは`systemd-networkd`なのでそっちの場合は`systemd`に統一しといたほうが後々楽.</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+$ systemctl start NetworkManager</span>
<span class="token inserted">+$ systemctl enable NetworkManager</span>
<span class="token inserted">+$ nmtui</span>
<span class="token inserted">+\```</span>
<span class="token inserted">+</span>
<span class="token inserted">+### 6.2 Setup X Window System</span>
<span class="token inserted">+[ref](https://wiki.archlinux.jp/index.php/Xorg)</span>
<span class="token inserted">+CUIからGUIへ.</span>
<span class="token inserted">+</span>
<span class="token inserted">+\```sh</span>
<span class="token inserted">+$ lspci | grep -e VGA -e 3D</span>
<span class="token inserted">+# XとDMとしてlight DM(とログイン画面)をインストール</span>
<span class="token inserted">+$ pacman -S xf86-video-intel xorg-server xorg-xrdb lightdm lightdm-gtk-greeter</span>
<span class="token inserted">+# terminal emulatorも入ってないので何かしらいれとく(1敗)</span>
<span class="token inserted">+$ pacman -S rxvt-unicode</span>
<span class="token inserted">+# </span>
<span class="token inserted">+$ systemctl enable lightdm</span>
<span class="token inserted">+# WMをインストール</span>
<span class="token inserted">+$ pacman -S i3-gaps i3status dmenu</span>
<span class="token inserted">+# tlp/バッテリ最適化モジュール</span>
<span class="token inserted">+$ pacman -S tlp</span>
<span class="token inserted">+# フォント</span>
<span class="token inserted">+# ブラウザやアプリはデフォだとシステム設定のフォント読まずに表示が汚くなるので、</span>
<span class="token inserted">+# デフォ指定に含まれているttf-dejavuを入れとく(Ubuntuのデフォフォント).</span>
<span class="token inserted">+$ pacman -S ttf-fira-code oft-ipamjfont ttf-dejavu</span>
<span class="token inserted">+# 画面の明るさ</span>
<span class="token inserted">+$ pacman -S xorg-xbacklight</span>
<span class="token inserted">+# 音量</span>
<span class="token inserted">+$ pacman -S pulseaudio-alsa alsa-utils alsa-plugins</span>
<span class="token inserted">+\```</span>
</code></pre></div></div></details></div><div class="Comments_comment__WxfzD" role="comment"><h2 class="Comments_title__YENiL">Comments</h2><div id="github-comment-container"></div></div></div><aside class="slug_aside__gL3UH"><nav class="Toc_toc__nav__rl0h7" role="navigation"><ul class="Toc_toc__Y4dWA"></ul></nav></aside></div></main><footer class="Footer_footer__FDcZZ"><small>Code snippets licensed under MIT, unless otherwise noted.</small></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"2020-06-05-install-arch-linux","title":"Install Arch Linux","categories":["Diary"],"image":"https://koka831.github.io/img/icon.png","tags":["Linux"],"content":"\u003ch2 id=\"0-partition-table\"\u003e\u003ca href=\"#0-partition-table\"\u003e0. Partition Table\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eインストール先のディスク名を調べる.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"terminal\" class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token output\"\u003e$fdisk -l\u003c/span\u003e\n\u003cspan class=\"token output\"\u003ebar\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"1-reset-partition\"\u003e\u003ca href=\"#1-reset-partition\"\u003e1. Reset Partition\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003ecgdisk/sgdiskを使う\n\u003cul\u003e\n\u003cli\u003ecgdiskがcursesベースなので使いやすい\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003ecgdisk /dev/nvme0n1\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003els\u003c/span\u003e -la\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003e最低限必要なpartitionは以下の3つ.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e/boot/efi: EFI\u003c/li\u003e\n\u003cli\u003e/boot    : Linux FS\u003c/li\u003e\n\u003cli\u003e/ (root) : Linux FS\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eブートセクタの開始領域がEFIになっている必要があるので、上から順に設定していく.\n/boot/efiが/bootに入れ子になっているが, mount時に調整する.\u003c/p\u003e\n\u003ch3 id=\"efi-partition\"\u003e\u003ca href=\"#efi-partition\"\u003eEFI partition\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e/boot/efi partition\n\u003cul\u003e\n\u003cli\u003eFirst Sector: Enter(default)\u003c/li\u003e\n\u003cli\u003eSize in sectors: 512M\u003c/li\u003e\n\u003cli\u003eHex code or GUID: ef00\u003c/li\u003e\n\u003cli\u003eEnter new partition name: EFI System\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"boot-partition\"\u003e\u003ca href=\"#boot-partition\"\u003eboot partition\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e/boot\n\u003cul\u003e\n\u003cli\u003eFirst Sector: Enter(default)\u003c/li\u003e\n\u003cli\u003eSize: 512M\u003c/li\u003e\n\u003cli\u003eHex: 8300\u003c/li\u003e\n\u003cli\u003eEnter new partition name: Linux filesystem\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"root-partition\"\u003e\u003ca href=\"#root-partition\"\u003eroot partition\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e/\n\u003cul\u003e\n\u003cli\u003eFirst Sector: Enter(default)\u003c/li\u003e\n\u003cli\u003eSize: Enter(default=max)\u003c/li\u003e\n\u003cli\u003eHex: 8300\u003c/li\u003e\n\u003cli\u003eEnter new partition name: Linux filesystem\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"result-of-partitioning\"\u003e\u003ca href=\"#result-of-partitioning\"\u003eResult of partitioning\u003c/a\u003e\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e512G SSDを対象に行うと以下のようになる.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003efdisk\u003c/span\u003e -l\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token output\"\u003eDevice          Start   End             Sectors Size    Type\u003c/span\u003e\n\u003cspan class=\"token output\"\u003e/dev/nvme0n1p1  2048    1050623         1048576 512M    Efi system\u003c/span\u003e\n\u003cspan class=\"token output\"\u003e/dev/nvme0n1p2 1050624  2099199         1048576 512M    Linux filesystem\u003c/span\u003e\n\u003cspan class=\"token output\"\u003e/dev/nvme0n1p3  2099200 1000215182    998115983 476G    Linux filesystem\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"2-disk-format\"\u003e\u003ca href=\"#2-disk-format\"\u003e2. Disk Format\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003emkfsを用いて各partitionをフォーマットする.\u003cbr\u003e\nefi領域はFAT32指定、その他Linux filesystemの領域はext4等好みのファイルシステムを用いる.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003emkfs.fat -F32 /dev/nvme0n1p1\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003emkfs.ext4 /dev/nvme0n1p2\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003emkfs.ext4 /dev/nvme0n1p3\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"3-mount-volume\"\u003e\u003ca href=\"#3-mount-volume\"\u003e3. Mount Volume\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e1, 2で作成したpartitionをboot USBからアクセスできるようにマウントする.\n1.で行ったパーティショニングとマウントの順番が異なるので注意(1敗).\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e#\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e/root\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003emount\u003c/span\u003e /dev/nvme0n1p3 /mnt\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e#\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e/boot\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003emkdir\u003c/span\u003e /mnt/boot\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003emount\u003c/span\u003e /dev/nvme0n1p2 /mnt/boot\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e#\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e/boot/efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003emkdir\u003c/span\u003e /mnt/boot/efi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003emount\u003c/span\u003e /dev/nvme0n1p1 /mnt/boot/efi\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"4-install-linux-system\"\u003e\u003ca href=\"#4-install-linux-system\"\u003e4. Install Linux system\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"setup-repository-mirror\"\u003e\u003ca href=\"#setup-repository-mirror\"\u003eSetup repository mirror\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003e/etc/pacman.d/mirrorlist\u003c/code\u003eを編集し現在位置から距離の近いミラーを一番上にもってくる.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003evim\u003c/span\u003e /etc/pacman.d/mirrorlist\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e#\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003euse mirror \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e Japan\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"install-base-system\"\u003e\u003ca href=\"#install-base-system\"\u003eInstall base system\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eマウントした\u003ccode\u003e/root\u003c/code\u003eに対してLinuxやその後の作業に必要な諸々をインストールする.\n後述する5.1でマウント領域に\u003ccode\u003echroot\u003c/code\u003eしたあとはboot USB内のデフォルトツール類が使えなくなるので, エディタはここでインストールしておく.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e#\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003elinux base system\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token output\"\u003epacstrap /mnt base linux linux-firmware\u003c/span\u003e\n\u003cspan class=\"token output\"\u003e\u003c/span\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e#\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e wifi\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token output\"\u003epacstrap /mnt base-devel grub efibootmgr dosfstools netctl iw wpa_supplicant networkmanager dialog vim\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"generate-fstab-file\"\u003e\u003ca href=\"#generate-fstab-file\"\u003egenerate fstab file\u003c/a\u003e\u003c/h3\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-sh\"\u003e\u003ccode class=\"language-sh\"\u003egenfstab -U /mnt \u0026#x26;gt;\u0026#x26;gt; /mnt/etc/fstab\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"check-filesystem\"\u003e\u003ca href=\"#check-filesystem\"\u003echeck filesystem\u003c/a\u003e\u003c/h3\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003ecat\u003c/span\u003e /mnt/etc/fstab\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token output\"\u003e/dev/nvme0n1p3 /         ext4 rw,relatime 0 1\u003c/span\u003e\n\u003cspan class=\"token output\"\u003e/dev/nvme0n1p2 /boot     ext4 rw,relatime 0 2\u003c/span\u003e\n\u003cspan class=\"token output\"\u003e/dev/nvme0n1p1 /boot/efi vfat rw,relatime,fmask=0022,codepage=... 0 2\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch2 id=\"5-enter-arch\"\u003e\u003ca href=\"#5-enter-arch\"\u003e5 enter arch!\u003c/a\u003e\u003c/h2\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token output\"\u003earch-chroot /mnt /bin/bash\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"setup-localetimezone\"\u003e\u003ca href=\"#setup-localetimezone\"\u003eSetup locale/timezone\u003c/a\u003e\u003c/h3\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e#\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003elocale\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003evim\u003c/span\u003e /etc/locale.gen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e#\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003euncomment en_US.UTF-8 and ja_JP.UTF-8\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003elocale-gen\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token builtin class-name\"\u003eecho\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"LANG=en_US.UTF-8\"\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e /etc/locale.conf\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e#\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003etimezone\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003etzselect \u003cspan class=\"token number\"\u003e4\u003c/span\u003e, \u003cspan class=\"token number\"\u003e19\u003c/span\u003e, \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003ehwclock --systohc --utc\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"setup-bootloader\"\u003e\u003ca href=\"#setup-bootloader\"\u003eSetup bootloader\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003ebootloaderの作成.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003emkinitcpio -p linux\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003egrub-install --target\u003cspan class=\"token operator\"\u003e=\u003c/span\u003ex86_64-efi --efi-directory\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e/boot/efi --bootloader-id\u003cspan class=\"token operator\"\u003e=\u003c/span\u003earch --boot-directory\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e/boot/efi/EFI --recheck\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003egrub-mkconfig\u003c/span\u003e -o /boot/efi/EFI/grub/grub.cfg\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"change-root-password--add-user\"\u003e\u003ca href=\"#change-root-password--add-user\"\u003eChange Root password \u0026#x26; add User\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e5.4にてリブートする前にユーザを作成しておく(1敗).\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003epasswd\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003euseradd\u003c/span\u003e -m -g \u003cspan class=\"token function\"\u003eusers\u003c/span\u003e -G wheel -s /bin/bash koka\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token function\"\u003epasswd\u003c/span\u003e koka\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003evisudo \u003cspan class=\"token comment\"\u003e# and uncomment %Wheel all=(all) all\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"reboot--eject-usb\"\u003e\u003ca href=\"#reboot--eject-usb\"\u003eReboot \u0026#x26; eject USB\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003eシャットダウンしてbootUSBを取り外し再起動する\u003c/p\u003e\n\u003ch2 id=\"6-setup-arch-linux\"\u003e\u003ca href=\"#6-setup-arch-linux\"\u003e6. Setup Arch Linux\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"network\"\u003e\u003ca href=\"#network\"\u003enetwork\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003ewifiの設定.\n\u003ccode\u003enmtui\u003c/code\u003eが好きなのでNetworkManagerを用いた.\nセットアップ後の開発において\u003ccode\u003esystemd-nspawn\u003c/code\u003eを使う場合, ネットワークアダプタは\u003ccode\u003esystemd-networkd\u003c/code\u003eなのでそっちの場合は\u003ccode\u003esystemd\u003c/code\u003eに統一しといたほうが後々楽.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003esystemctl start NetworkManager\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003esystemctl \u003cspan class=\"token builtin class-name\"\u003eenable\u003c/span\u003e NetworkManager\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003enmtui\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003ch3 id=\"setup-x-window-system\"\u003e\u003ca href=\"#setup-x-window-system\"\u003eSetup X Window System\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://wiki.archlinux.jp/index.php/Xorg\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eref\u003c/a\u003e\nCUIからGUIへ.\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-shell-session\"\u003e\u003ccode class=\"language-shell-session\"\u003e\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003elspci \u003cspan class=\"token operator\"\u003e|\u003c/span\u003e \u003cspan class=\"token function\"\u003egrep\u003c/span\u003e -e VGA -e 3D\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# XとDMとしてlight DM(とログイン画面)をインストール\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003epacman -S xf86-video-intel xorg-server xorg-xrdb lightdm lightdm-gtk-greeter\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# terminal emulatorも入ってないので何かしらいれとく(1敗)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003epacman -S rxvt-unicode\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003esystemctl \u003cspan class=\"token builtin class-name\"\u003eenable\u003c/span\u003e lightdm\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# WMをインストール\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003epacman -S i3-gaps i3status dmenu\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# tlp/バッテリ最適化モジュール\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003epacman -S tlp\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# フォント\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# ブラウザやアプリはデフォだとシステム設定のフォント読まずに表示が汚くなるので、\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003e\u003cspan class=\"token comment\"\u003e# デフォ指定に含まれているttf-dejavuを入れとく(Ubuntuのデフォフォント).\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003epacman -S ttf-fira-code oft-ipamjfont ttf-dejavu\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003epacman -S xorg-xbacklight \u003cspan class=\"token comment\"\u003e# 画面の明るさ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"token command\"\u003e\u003cspan class=\"token shell-symbol important\"\u003e$\u003c/span\u003e \u003cspan class=\"token bash language-bash\"\u003epacman -S pulseaudio-alsa alsa-utils alsa-plugins \u003cspan class=\"token comment\"\u003e# 音量\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e","description":"log","commits":[{"title":"fix some","date":"2021-10-13 23:48:16","hash":"fc674d6b","diff":"\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"fc674d6b.patch\" class=\"language-git  language-diff\"\u003e\u003ccode class=\"language-git\"\u003e\u003cspan class=\"token commit-sha1\"\u003ecommit fc674d6b05dbbc38f77579f9120500b8c4a81926\u003c/span\u003e\nAuthor: koka \u0026#x26;\u003ca href=\"mailto:lt;koka.code@gmail.com\" class=\"token email-link\"\u003elt;koka.code@gmail.com\u003c/a\u003e\u0026#x26;gt;\nDate:   Wed Oct 13 23:48:16 2021 +0900\n\n  fix some\n\ndiff --git a/_posts/2020-06-05-install-arch-linux.md b/_posts/2020-06-05-install-arch-linux.md\nindex f71dd06..1e2b358 100644\n\u003cspan class=\"token deleted\"\u003e--- a/_posts/2020-06-05-install-arch-linux.md\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+++ b/_posts/2020-06-05-install-arch-linux.md\u003c/span\u003e\n@@ -21,20 +21,7 @@ bar\n   - cgdiskがcursesベースなので使いやすい\n\n\\```shell-session\n\u003cspan class=\"token deleted\"\u003e-$echo $EDITOR\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-vim\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-$git checkout master\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-Switched to branch 'master'\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-Your branch is up-to-date with 'origin/master'\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-#foo\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-$git push\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-Everything up-to-date\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-[sudo] password for koka:\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-$echo 'All\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-\u0026#x26;gt; done!'\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-All\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-done!\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-$cgdisk /dev/nvme0n1\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ cgdisk /dev/nvme0n1\u003c/span\u003e\n\\```\n\n\\```shell-session\n@@ -78,7 +65,7 @@ $ ls -la\n\u003cspan class=\"token comment\"\u003e### Result of partitioning\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e- 512G SSDを対象に行うと以下のようになる.\u003c/span\u003e\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n$ fdisk -l\nDevice          Start   End             Sectors Size    Type\n/dev/nvme0n1p1  2048    1050623         1048576 512M    Efi system\n@@ -90,10 +77,10 @@ Device          Start   End             Sectors Size    Type\nmkfsを用いて各partitionをフォーマットする.  \nefi領域はFAT32指定、その他Linux filesystemの領域はext4等好みのファイルシステムを用いる.\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-mkfs.fat -F32 /dev/nvme0n1p1\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-mkfs.ext4 /dev/nvme0n1p2\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-mkfs.ext4 /dev/nvme0n1p3\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ mkfs.fat -F32 /dev/nvme0n1p1\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ mkfs.ext4 /dev/nvme0n1p2\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ mkfs.ext4 /dev/nvme0n1p3\u003c/span\u003e\n\\```\n\n\u003cspan class=\"token comment\"\u003e## 3. Mount Volume\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"},{"title":"fix","date":"2021-04-25 14:18:15","hash":"dae19db3","diff":"\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"dae19db3.patch\" class=\"language-git  language-diff\"\u003e\u003ccode class=\"language-git\"\u003e\u003cspan class=\"token commit-sha1\"\u003ecommit dae19db337b318bfe27a5713113f2e56341e0b2e\u003c/span\u003e\nAuthor: koka \u0026#x26;\u003ca href=\"mailto:lt;koka.code@gmail.com\" class=\"token email-link\"\u003elt;koka.code@gmail.com\u003c/a\u003e\u0026#x26;gt;\nDate:   Sun Apr 25 14:18:15 2021 +0900\n\n  fix\n\ndiff --git a/_posts/2020-06-05-install-arch-linux.md b/_posts/2020-06-05-install-arch-linux.md\nindex 0bff7c6..f71dd06 100644\n\u003cspan class=\"token deleted\"\u003e--- a/_posts/2020-06-05-install-arch-linux.md\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+++ b/_posts/2020-06-05-install-arch-linux.md\u003c/span\u003e\n@@ -16,13 +16,6 @@ $fdisk -l\nbar\n\\```\n\n\u003cspan class=\"token deleted\"\u003e-[[info | custom container]]\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-| content\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-| bar\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-multi line\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e## 1. Reset Partition\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e- cgdisk/sgdiskを使う\u003c/span\u003e\n   - cgdiskがcursesベースなので使いやすい\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"},{"title":"wip","date":"2021-03-05 18:48:41","hash":"70a0aff5","diff":"\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"70a0aff5.patch\" class=\"language-git  language-diff\"\u003e\u003ccode class=\"language-git\"\u003e\u003cspan class=\"token commit-sha1\"\u003ecommit 70a0aff5a83d4332a8c3ccff3d2d3c1c84e46ef2\u003c/span\u003e\nAuthor: koka \u0026#x26;\u003ca href=\"mailto:lt;koka.code@gmail.com\" class=\"token email-link\"\u003elt;koka.code@gmail.com\u003c/a\u003e\u0026#x26;gt;\nDate:   Fri Mar 5 18:48:41 2021 +0900\n\n  wip\n\ndiff --git a/_posts/2020-06-05-install-arch-linux.md b/_posts/2020-06-05-install-arch-linux.md\nindex f71dd06..0bff7c6 100644\n\u003cspan class=\"token deleted\"\u003e--- a/_posts/2020-06-05-install-arch-linux.md\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+++ b/_posts/2020-06-05-install-arch-linux.md\u003c/span\u003e\n@@ -16,6 +16,13 @@ $fdisk -l\nbar\n\\```\n\n\u003cspan class=\"token inserted\"\u003e+[[info | custom container]]\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+| content\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+| bar\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+multi line\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e## 1. Reset Partition\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e- cgdisk/sgdiskを使う\u003c/span\u003e\n   - cgdiskがcursesベースなので使いやすい\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"},{"title":"update","date":"2021-02-15 00:34:10","hash":"bd59f09a","diff":"\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"bd59f09a.patch\" class=\"language-git  language-diff\"\u003e\u003ccode class=\"language-git\"\u003e\u003cspan class=\"token commit-sha1\"\u003ecommit bd59f09a33181a1f762978251b6b4d7eb0095a09\u003c/span\u003e\nAuthor: koka \u0026#x26;\u003ca href=\"mailto:lt;koka.code@gmail.com\" class=\"token email-link\"\u003elt;koka.code@gmail.com\u003c/a\u003e\u0026#x26;gt;\nDate:   Mon Feb 15 00:34:10 2021 +0900\n\n  update\n\ndiff --git a/_posts/2020-06-05-install-arch-linux.md b/_posts/2020-06-05-install-arch-linux.md\nindex 30bf785..f71dd06 100644\n\u003cspan class=\"token deleted\"\u003e--- a/_posts/2020-06-05-install-arch-linux.md\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+++ b/_posts/2020-06-05-install-arch-linux.md\u003c/span\u003e\n@@ -11,16 +11,34 @@ description: log\n\u003cspan class=\"token comment\"\u003e## 0. Partition Table\u003c/span\u003e\nインストール先のディスク名を調べる.\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-fdisk -l\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session[data-file=\"terminal\"]\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$fdisk -l\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+bar\u003c/span\u003e\n\\```\n\n\u003cspan class=\"token comment\"\u003e## 1. Reset Partition\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e- cgdisk/sgdiskを使う\u003c/span\u003e\n   - cgdiskがcursesベースなので使いやすい\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-cgdisk /dev/nvme0n1\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$echo $EDITOR\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+vim\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$git checkout master\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+Switched to branch 'master'\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+Your branch is up-to-date with 'origin/master'\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+#foo\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$git push\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+Everything up-to-date\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[sudo] password for koka:\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$echo 'All\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u0026#x26;gt; done!'\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+All\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+done!\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$cgdisk /dev/nvme0n1\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ ls -la\u003c/span\u003e\n\\```\n\n最低限必要なpartitionは以下の3つ. \n@@ -32,7 +50,7 @@ cgdisk /dev/nvme0n1\nブートセクタの開始領域がEFIになっている必要があるので、上から順に設定していく.\n/boot/efiが/bootに入れ子になっているが, mount時に調整する.\n\n\u003cspan class=\"token deleted\"\u003e-### 1.1 EFI partition\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### EFI partition\u003c/span\u003e\n\n\u003cspan class=\"token deleted\"\u003e- /boot/efi partition\u003c/span\u003e\n   - First Sector: Enter(default)\n@@ -40,7 +58,7 @@ cgdisk /dev/nvme0n1\n   - Hex code or GUID: ef00\n   - Enter new partition name: EFI System\n\n\u003cspan class=\"token deleted\"\u003e-### 1.2 boot partition\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### boot partition\u003c/span\u003e\n\n\u003cspan class=\"token deleted\"\u003e- /boot\u003c/span\u003e\n   - First Sector: Enter(default)\n@@ -48,7 +66,7 @@ cgdisk /dev/nvme0n1\n   - Hex: 8300\n   - Enter new partition name: Linux filesystem\n\n\u003cspan class=\"token deleted\"\u003e-### 1.3 root partition\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### root partition\u003c/span\u003e\n\n\u003cspan class=\"token deleted\"\u003e- /\u003c/span\u003e\n   - First Sector: Enter(default)\n@@ -57,7 +75,7 @@ cgdisk /dev/nvme0n1\n   - Enter new partition name: Linux filesystem\n\n\n\u003cspan class=\"token deleted\"\u003e-### 1.4 Result of partitioning\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### Result of partitioning\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e- 512G SSDを対象に行うと以下のようになる.\u003c/span\u003e\n\n\\```sh\n@@ -82,53 +100,52 @@ mkfs.ext4 /dev/nvme0n1p3\n1, 2で作成したpartitionをboot USBからアクセスできるようにマウントする.\n1.で行ったパーティショニングとマウントの順番が異なるので注意(1敗).\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# /root\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-mount /dev/nvme0n1p3 /mnt\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ mount /dev/nvme0n1p3 /mnt\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# /boot\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-mkdir /mnt/boot\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-mount /dev/nvme0n1p2 /mnt/boot\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ mkdir /mnt/boot\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ mount /dev/nvme0n1p2 /mnt/boot\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e# /boot/efi\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-mkdir /mnt/boot/efi\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-mount /dev/nvme0n1p1 /mnt/boot/efi\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ mkdir /mnt/boot/efi\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ mount /dev/nvme0n1p1 /mnt/boot/efi\u003c/span\u003e\n\\```\n\n\u003cspan class=\"token comment\"\u003e## 4. Install Linux system\u003c/span\u003e\n\n\u003cspan class=\"token deleted\"\u003e-### 4.1 Setup repository mirror\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### Setup repository mirror\u003c/span\u003e\n`/etc/pacman.d/mirrorlist`を編集し現在位置から距離の近いミラーを一番上にもってくる.\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-vim /etc/pacman.d/mirrorlist\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ vim /etc/pacman.d/mirrorlist\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# use mirror in Japan\u003c/span\u003e\n\\```\n\n\n\u003cspan class=\"token deleted\"\u003e-### 4.2 Install base system\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### Install base system\u003c/span\u003e\nマウントした`/root`に対してLinuxやその後の作業に必要な諸々をインストールする.\n後述する5.1でマウント領域に`chroot`したあとはboot USB内のデフォルトツール類が使えなくなるので, エディタはここでインストールしておく.\n\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# linux base system\u003c/span\u003e\npacstrap /mnt base linux linux-firmware\n\u003cspan class=\"token comment\"\u003e# for wifi\u003c/span\u003e\npacstrap /mnt base-devel grub efibootmgr dosfstools netctl iw wpa_supplicant networkmanager dialog vim\n\\```\n\n\u003cspan class=\"token deleted\"\u003e-### 4.3 generate fstab file\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### generate fstab file\u003c/span\u003e\n\n\\```sh\ngenfstab -U /mnt \u0026#x26;gt;\u0026#x26;gt; /mnt/etc/fstab\n\\```\n\n\u003cspan class=\"token deleted\"\u003e-### 4.4 check filesystem\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### check filesystem\u003c/span\u003e\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n$ cat /mnt/etc/fstab\n\u003cspan class=\"token deleted\"\u003e-\u003c/span\u003e\n/dev/nvme0n1p3 /         ext4 rw,relatime 0 1\n/dev/nvme0n1p2 /boot     ext4 rw,relatime 0 2\n/dev/nvme0n1p1 /boot/efi vfat rw,relatime,fmask=0022,codepage=... 0 2\n@@ -137,13 +154,13 @@ $ cat /mnt/etc/fstab\n\n\u003cspan class=\"token comment\"\u003e## 5 enter arch!\u003c/span\u003e\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\narch-chroot /mnt /bin/bash\n\\```\n\n\u003cspan class=\"token deleted\"\u003e-### 5.1 Setup locale/timezone\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### Setup locale/timezone\u003c/span\u003e\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e# locale\u003c/span\u003e\n$ vim /etc/locale.gen\n\u003cspan class=\"token comment\"\u003e# uncomment en_US.UTF-8 and ja_JP.UTF-8\u003c/span\u003e\n@@ -155,62 +172,60 @@ $ tzselect 4, 19, 1\n$ hwclock --systohc --utc\n\\```\n\n\u003cspan class=\"token deleted\"\u003e-### 5.2 Setup bootloader\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### Setup bootloader\u003c/span\u003e\nbootloaderの作成.\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n$ mkinitcpio -p linux\n$ grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=arch --boot-directory=/boot/efi/EFI --recheck\n$ grub-mkconfig -o /boot/efi/EFI/grub/grub.cfg\n\\```\n\n\u003cspan class=\"token deleted\"\u003e-### 5.3 Change Root password \u0026#x26; add User\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### Change Root password \u0026#x26; add User\u003c/span\u003e\n5.4にてリブートする前にユーザを作成しておく(1敗).\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n$ passwd\n$ useradd -m -g users -G wheel -s /bin/bash koka\n$ passwd koka\n$ visudo # and uncomment %Wheel all=(all) all\n\\```\n\u003cspan class=\"token deleted\"\u003e-### 5.4 Reboot \u0026#x26; eject USB\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### Reboot \u0026#x26; eject USB\u003c/span\u003e\nシャットダウンしてbootUSBを取り外し再起動する\n\n\u003cspan class=\"token comment\"\u003e## 6. Setup Arch Linux\u003c/span\u003e\n\n\u003cspan class=\"token deleted\"\u003e-### 6.1 network\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### network\u003c/span\u003e\nwifiの設定.\n`nmtui`が好きなのでNetworkManagerを用いた.\nセットアップ後の開発において`systemd-nspawn`を使う場合, ネットワークアダプタは`systemd-networkd`なのでそっちの場合は`systemd`に統一しといたほうが後々楽.\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n$ systemctl start NetworkManager\n$ systemctl enable NetworkManager\n$ nmtui\n\\```\n\n\u003cspan class=\"token deleted\"\u003e-### 6.2 Setup X Window System\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### Setup X Window System\u003c/span\u003e\n[ref](\u003ca href=\"https://wiki.archlinux.jp/index.php/Xorg\" class=\"token url-link\"\u003ehttps://wiki.archlinux.jp/index.php/Xorg\u003c/a\u003e)\nCUIからGUIへ.\n\n\u003cspan class=\"token deleted\"\u003e-\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```shell-session\u003c/span\u003e\n$ lspci | grep -e VGA -e 3D\n\u003cspan class=\"token deleted\"\u003e-# XとDMとしてlight DM(とログイン画面)をインストール\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ # XとDMとしてlight DM(とログイン画面)をインストール\u003c/span\u003e\n$ pacman -S xf86-video-intel xorg-server xorg-xrdb lightdm lightdm-gtk-greeter\n\u003cspan class=\"token deleted\"\u003e-# terminal emulatorも入ってないので何かしらいれとく(1敗)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ # terminal emulatorも入ってないので何かしらいれとく(1敗)\u003c/span\u003e\n$ pacman -S rxvt-unicode\n\u003cspan class=\"token deleted\"\u003e-# \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n$ systemctl enable lightdm\n\u003cspan class=\"token deleted\"\u003e-# WMをインストール\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ # WMをインストール\u003c/span\u003e\n$ pacman -S i3-gaps i3status dmenu\n\u003cspan class=\"token deleted\"\u003e-# tlp/バッテリ最適化モジュール\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ # tlp/バッテリ最適化モジュール\u003c/span\u003e\n$ pacman -S tlp\n\u003cspan class=\"token deleted\"\u003e-# フォント\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-# ブラウザやアプリはデフォだとシステム設定のフォント読まずに表示が汚くなるので、\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-# デフォ指定に含まれているttf-dejavuを入れとく(Ubuntuのデフォフォント).\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ # フォント\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ # ブラウザやアプリはデフォだとシステム設定のフォント読まずに表示が汚くなるので、\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ # デフォ指定に含まれているttf-dejavuを入れとく(Ubuntuのデフォフォント).\u003c/span\u003e\n$ pacman -S ttf-fira-code oft-ipamjfont ttf-dejavu\n\u003cspan class=\"token deleted\"\u003e-# 画面の明るさ\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-$ pacman -S xorg-xbacklight\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-# 音量\u003c/span\u003e\n\u003cspan class=\"token deleted\"\u003e-$ pacman -S pulseaudio-alsa alsa-utils alsa-plugins\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ pacman -S xorg-xbacklight # 画面の明るさ\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ pacman -S pulseaudio-alsa alsa-utils alsa-plugins # 音量\u003c/span\u003e\n\\```\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"},{"title":"copy md","date":"2021-01-30 22:18:17","hash":"35b550ae","diff":"\u003cdiv class=\"remark-highlight\"\u003e\u003cpre data-file=\"35b550ae.patch\" class=\"language-git  language-diff\"\u003e\u003ccode class=\"language-git\"\u003e\u003cspan class=\"token commit-sha1\"\u003ecommit 35b550ae83af4efaeadf33471c8ca8a32c1079c8\u003c/span\u003e\nAuthor: koka \u0026#x26;\u003ca href=\"mailto:lt;koka.code@gmail.com\" class=\"token email-link\"\u003elt;koka.code@gmail.com\u003c/a\u003e\u0026#x26;gt;\nDate:   Sat Jan 30 22:18:17 2021 +0900\n\n  copy md\n\ndiff --git a/_posts/2020-06-05-install-arch-linux.md b/_posts/2020-06-05-install-arch-linux.md\nnew file mode 100644\nindex 0000000..30bf785\n\u003cspan class=\"token deleted\"\u003e--- /dev/null\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+++ b/_posts/2020-06-05-install-arch-linux.md\u003c/span\u003e\n\u003cspan class=\"token coord\"\u003e@@ -0,0 +1,216 @@\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+---\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+title: 'Install Arch Linux'\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+date: 2020-06-05\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+categories:\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- Diary\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+tags:\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- Linux\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+description: log\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+---\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## 0. Partition Table\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+インストール先のディスク名を調べる.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+fdisk -l\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## 1. Reset Partition\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- cgdisk/sgdiskを使う\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - cgdiskがcursesベースなので使いやすい\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+cgdisk /dev/nvme0n1\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+最低限必要なpartitionは以下の3つ. \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- /boot/efi: EFI\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- /boot    : Linux FS\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- / (root) : Linux FS\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+ブートセクタの開始領域がEFIになっている必要があるので、上から順に設定していく.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+/boot/efiが/bootに入れ子になっているが, mount時に調整する.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 1.1 EFI partition\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- /boot/efi partition\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - First Sector: Enter(default)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - Size in sectors: 512M\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - Hex code or GUID: ef00\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - Enter new partition name: EFI System\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 1.2 boot partition\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- /boot\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - First Sector: Enter(default)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - Size: 512M\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - Hex: 8300\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - Enter new partition name: Linux filesystem\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 1.3 root partition\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- /\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - First Sector: Enter(default)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - Size: Enter(default=max)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - Hex: 8300\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+    - Enter new partition name: Linux filesystem\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 1.4 Result of partitioning\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+- 512G SSDを対象に行うと以下のようになる.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ fdisk -l\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+Device          Start   End             Sectors Size    Type\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+/dev/nvme0n1p1  2048    1050623         1048576 512M    Efi system\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+/dev/nvme0n1p2 1050624  2099199         1048576 512M    Linux filesystem\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+/dev/nvme0n1p3  2099200 1000215182    998115983 476G    Linux filesystem\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## 2. Disk Format\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+mkfsを用いて各partitionをフォーマットする.  \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+efi領域はFAT32指定、その他Linux filesystemの領域はext4等好みのファイルシステムを用いる.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+mkfs.fat -F32 /dev/nvme0n1p1\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+mkfs.ext4 /dev/nvme0n1p2\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+mkfs.ext4 /dev/nvme0n1p3\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## 3. Mount Volume\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+1, 2で作成したpartitionをboot USBからアクセスできるようにマウントする.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+1.で行ったパーティショニングとマウントの順番が異なるので注意(1敗).\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# /root\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+mount /dev/nvme0n1p3 /mnt\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# /boot\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+mkdir /mnt/boot\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+mount /dev/nvme0n1p2 /mnt/boot\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# /boot/efi\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+mkdir /mnt/boot/efi\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+mount /dev/nvme0n1p1 /mnt/boot/efi\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## 4. Install Linux system\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 4.1 Setup repository mirror\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+`/etc/pacman.d/mirrorlist`を編集し現在位置から距離の近いミラーを一番上にもってくる.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+vim /etc/pacman.d/mirrorlist\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# use mirror in Japan\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 4.2 Install base system\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+マウントした`/root`に対してLinuxやその後の作業に必要な諸々をインストールする.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+後述する5.1でマウント領域に`chroot`したあとはboot USB内のデフォルトツール類が使えなくなるので, エディタはここでインストールしておく.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# linux base system\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+pacstrap /mnt base linux linux-firmware\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# for wifi\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+pacstrap /mnt base-devel grub efibootmgr dosfstools netctl iw wpa_supplicant networkmanager dialog vim\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 4.3 generate fstab file\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+genfstab -U /mnt \u0026#x26;gt;\u0026#x26;gt; /mnt/etc/fstab\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 4.4 check filesystem\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ cat /mnt/etc/fstab\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+/dev/nvme0n1p3 /         ext4 rw,relatime 0 1\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+/dev/nvme0n1p2 /boot     ext4 rw,relatime 0 2\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+/dev/nvme0n1p1 /boot/efi vfat rw,relatime,fmask=0022,codepage=... 0 2\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## 5 enter arch!\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+arch-chroot /mnt /bin/bash\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 5.1 Setup locale/timezone\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# locale\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ vim /etc/locale.gen\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# uncomment en_US.UTF-8 and ja_JP.UTF-8\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ locale-gen\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ echo \"LANG=en_US.UTF-8\" \u0026#x26;gt; /etc/locale.conf\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# timezone\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ tzselect 4, 19, 1\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ hwclock --systohc --utc\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 5.2 Setup bootloader\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+bootloaderの作成.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ mkinitcpio -p linux\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=arch --boot-directory=/boot/efi/EFI --recheck\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ grub-mkconfig -o /boot/efi/EFI/grub/grub.cfg\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 5.3 Change Root password \u0026#x26; add User\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+5.4にてリブートする前にユーザを作成しておく(1敗).\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ passwd\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ useradd -m -g users -G wheel -s /bin/bash koka\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ passwd koka\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ visudo # and uncomment %Wheel all=(all) all\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 5.4 Reboot \u0026#x26; eject USB\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+シャットダウンしてbootUSBを取り外し再起動する\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+## 6. Setup Arch Linux\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 6.1 network\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+wifiの設定.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+`nmtui`が好きなのでNetworkManagerを用いた.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+セットアップ後の開発において`systemd-nspawn`を使う場合, ネットワークアダプタは`systemd-networkd`なのでそっちの場合は`systemd`に統一しといたほうが後々楽.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ systemctl start NetworkManager\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ systemctl enable NetworkManager\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ nmtui\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+### 6.2 Setup X Window System\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+[ref](https://wiki.archlinux.jp/index.php/Xorg)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+CUIからGUIへ.\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```sh\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ lspci | grep -e VGA -e 3D\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# XとDMとしてlight DM(とログイン画面)をインストール\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ pacman -S xf86-video-intel xorg-server xorg-xrdb lightdm lightdm-gtk-greeter\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# terminal emulatorも入ってないので何かしらいれとく(1敗)\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ pacman -S rxvt-unicode\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# \u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ systemctl enable lightdm\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# WMをインストール\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ pacman -S i3-gaps i3status dmenu\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# tlp/バッテリ最適化モジュール\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ pacman -S tlp\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# フォント\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# ブラウザやアプリはデフォだとシステム設定のフォント読まずに表示が汚くなるので、\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# デフォ指定に含まれているttf-dejavuを入れとく(Ubuntuのデフォフォント).\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ pacman -S ttf-fira-code oft-ipamjfont ttf-dejavu\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# 画面の明るさ\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ pacman -S xorg-xbacklight\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+# 音量\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+$ pacman -S pulseaudio-alsa alsa-utils alsa-plugins\u003c/span\u003e\n\u003cspan class=\"token inserted\"\u003e+\\```\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e"}],"publishedAt":"2020-06-05","updatedAt":"2021-10-13"}},"__N_SSG":true},"page":"/archives/[slug]","query":{"slug":"2020-06-05-install-arch-linux"},"buildId":"znmYoLexqSmMsB-BwArHq","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>