{"pageProps":{"post":{"slug":"2019-07-27-linux-usergroup","title":"Linux: 画面の明るさを変更できなくなった","categories":["diary"],"image":"https://koka831.github.io/img/icon.png","tags":["Linux","udev"],"content":"<h2 id=\"tl-dr\"><a href=\"#tl-dr\">TL; DR</a></h2>\n<ul>\n<li>作業ユーザを<code>video</code>グループに追加</li>\n<li>udevのrulesを追加し<code>brightness</code>デバイスへの書き込み権限を付与</li>\n</ul>\n<h2 id=\"概要\"><a href=\"#概要\">概要</a></h2>\n<p>Thinkpad X1 Carbon(2019)を購入したので，Gentooをインストールした.\nが，F5, F6での明るさ調整が効かなかった. クッソまぶしい.</p>\n<p>明るさ調整には<code>light</code>コマンドを用いたところ，<code>sudo light -A 5</code>のようにroot権限を用いると調整が行えた.</p>\n<h2 id=\"解決策\"><a href=\"#解決策\">解決策</a></h2>\n<ol>\n<li>作業ユーザを<code>video</code>グループに追加する.</li>\n</ol>\n<p>usergroupは以下で確認できる.</p>\n<div class=\"remark-highlight\"><pre class=\"language-sh\"><code class=\"language-sh\">$ <span class=\"token function\">cut</span> -d: <span class=\"token parameter variable\">-f1</span> /etc/group\n</code></pre></div>\n<p>そのなかでもメジャーなものは以下(独断).</p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th align=\"center\">name</th><th align=\"center\">role</th></tr></thead><tbody><tr><td align=\"center\">wheel</td><td align=\"center\">管理権限作業用グループ</td></tr><tr><td align=\"center\">log</td><td align=\"center\">/var/log/ へのアクセス用グループ</td></tr><tr><td align=\"center\">video</td><td align=\"center\">ビデオキャプチャ・フレームバッファアクセス</td></tr><tr><td align=\"center\">docker</td><td align=\"center\">docker作業用グループ</td></tr></tbody></table>\n<div class=\"remark-highlight\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token function\">usermod</span> <span class=\"token parameter variable\">-aG</span> video <span class=\"token variable\">${<span class=\"token environment constant\">USER</span>}</span>\n</code></pre></div>\n<p><code>usermod</code>コマンドを用いて<code>$USER</code>をグループに追加する.<br>\n例えば<code>$USER</code>を<code>docker</code>グループに追加した場合, <code>$USER</code>は<code>docker</code>の操作に管理者権限が不要となる.</p>\n<p>(ただ第三者が作成したスクリプトであってもroot権限で実行できるということなので，<code>docker</code>を用いる場合には<code>newgrp</code>を用いて一時的にグループを変更するなどのほうがいいと思う. <code>docker</code>の場合権限昇格などのリスクもあるので気をつけよう．お兄さんとの約束だよ)</p>\n<ol start=\"2\">\n<li><code>brightness</code>デバイスの書き込み権限を<code>video</code>グループに付与する.</li>\n</ol>\n<p>画面の明るさ(<code>brightness</code>)は<code>udev</code>によって管理されている.\n<code>/usr/lib/udev/rules.d/xx-brightness.rules</code>を次のように記述する.</p>\n<div class=\"remark-highlight\"><pre class=\"language-unknown\"><code class=\"language-unknown\">ACTION==&#x26;quot;add&#x26;quot;, SUBSYSTEM==&#x26;quot;backlight&#x26;quot;, RUN+=&#x26;quot;/bin/chgrp video /sys/class/backlight/%k/brightness&#x26;quot;\nACTION==&#x26;quot;add&#x26;quot;, SUBSYSTEM==&#x26;quot;backlight&#x26;quot;, RUN+=&#x26;quot;/bin/chmod g+w /sys/class/backlight/%k/brightness&#x26;quot;</code></pre></div>\n<p>これで起動時に<code>video</code>グループに対して<code>brightness</code>デバイスへの書き込み権限が付与される.</p>\n<h2 id=\"追記\"><a href=\"#追記\">追記</a></h2>\n<p>かわいい感じになりました. yay\n</p><figure><img src=\"./img/desktop.png\" alt=\"\"><figcaption>img.1 </figcaption></figure><p></p>\n<h2 id=\"reference\"><a href=\"#reference\">reference</a></h2>\n<ul>\n<li><a href=\"https://wiki.archlinux.jp/index.php/%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%A8%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97\" rel=\"nofollow\">arch linux#グループ一覧</a></li>\n<li><a href=\"https://wiki.archlinux.org/index.php/Backlight\" rel=\"nofollow\">arch linux#brightness</a></li>\n</ul>","description":"バルス","commits":[{"title":"copy md","date":"2021-01-30 22:18:17","hash":"35b550ae","diff":"<div class=\"remark-highlight\"><pre data-file=\"35b550ae.patch\" class=\"language-git language-diff\"><code class=\"language-git\"><span class=\"token commit-sha1\">commit 35b550ae83af4efaeadf33471c8ca8a32c1079c8</span>\nAuthor: koka &#x26;<a href=\"mailto:lt;koka.code@gmail.com\" class=\"token email-link\">lt;koka.code@gmail.com</a>&#x26;gt;\nDate:   Sat Jan 30 22:18:17 2021 +0900\n\n  copy md\n\ndiff --git a/_posts/2019-07-27-linux-usergroup.md b/_posts/2019-07-27-linux-usergroup.md\nnew file mode 100644\nindex 0000000..0bafcf1\n<span class=\"token deleted\">--- /dev/null</span>\n<span class=\"token inserted\">+++ b/_posts/2019-07-27-linux-usergroup.md</span>\n<span class=\"token coord\">@@ -0,0 +1,65 @@</span>\n<span class=\"token inserted\">+---</span>\n<span class=\"token inserted\">+title: 'Linux: 画面の明るさを変更できなくなった'</span>\n<span class=\"token inserted\">+date: 2019-07-27</span>\n<span class=\"token inserted\">+categories:</span>\n<span class=\"token inserted\">+- diary</span>\n<span class=\"token inserted\">+tags:</span>\n<span class=\"token inserted\">+- Linux</span>\n<span class=\"token inserted\">+- udev</span>\n<span class=\"token inserted\">+description: バルス</span>\n<span class=\"token inserted\">+---</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+## TL; DR</span>\n<span class=\"token inserted\">+- 作業ユーザを`video`グループに追加</span>\n<span class=\"token inserted\">+- udevのrulesを追加し`brightness`デバイスへの書き込み権限を付与</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+## 概要</span>\n<span class=\"token inserted\">+Thinkpad X1 Carbon(2019)を購入したので，Gentooをインストールした. </span>\n<span class=\"token inserted\">+が，F5, F6での明るさ調整が効かなかった. クッソまぶしい.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+明るさ調整には`light`コマンドを用いたところ，`sudo light -A 5`のようにroot権限を用いると調整が行えた.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+## 解決策</span>\n<span class=\"token inserted\">+1. 作業ユーザを`video`グループに追加する.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+usergroupは以下で確認できる.</span>\n<span class=\"token inserted\">+\\```sh</span>\n<span class=\"token inserted\">+$ cut -d: -f1 /etc/group</span>\n<span class=\"token inserted\">+\\```</span>\n<span class=\"token inserted\">+そのなかでもメジャーなものは以下(独断).</span>\n<span class=\"token inserted\">+|name|role|</span>\n<span class=\"token inserted\">+|:---:|:---:|</span>\n<span class=\"token inserted\">+|wheel| 管理権限作業用グループ|</span>\n<span class=\"token inserted\">+|log| /var/log/ へのアクセス用グループ|</span>\n<span class=\"token inserted\">+|video| ビデオキャプチャ・フレームバッファアクセス|</span>\n<span class=\"token inserted\">+|docker| docker作業用グループ|</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+\\```sh</span>\n<span class=\"token inserted\">+usermod -aG video ${USER}</span>\n<span class=\"token inserted\">+\\```</span>\n<span class=\"token inserted\">+`usermod`コマンドを用いて`$USER`をグループに追加する.  </span>\n<span class=\"token inserted\">+例えば`$USER`を`docker`グループに追加した場合, `$USER`は`docker`の操作に管理者権限が不要となる.  </span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+(ただ第三者が作成したスクリプトであってもroot権限で実行できるということなので，`docker`を用いる場合には`newgrp`を用いて一時的にグループを変更するなどのほうがいいと思う. `docker`の場合権限昇格などのリスクもあるので気をつけよう．お兄さんとの約束だよ)</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+2. `brightness`デバイスの書き込み権限を`video`グループに付与する.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+画面の明るさ(`brightness`)は`udev`によって管理されている. </span>\n<span class=\"token inserted\">+`/usr/lib/udev/rules.d/xx-brightness.rules`を次のように記述する.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+\\```</span>\n<span class=\"token inserted\">+ACTION==\"add\", SUBSYSTEM==\"backlight\", RUN+=\"/bin/chgrp video /sys/class/backlight/%k/brightness\"</span>\n<span class=\"token inserted\">+ACTION==\"add\", SUBSYSTEM==\"backlight\", RUN+=\"/bin/chmod g+w /sys/class/backlight/%k/brightness\"</span>\n<span class=\"token inserted\">+\\```</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+これで起動時に`video`グループに対して`brightness`デバイスへの書き込み権限が付与される.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+## 追記</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+かわいい感じになりました. yay</span>\n<span class=\"token inserted\">+![](./img/desktop.png)</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+## reference</span>\n<span class=\"token inserted\">+- [arch linux#グループ一覧](https://wiki.archlinux.jp/index.php/%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%A8%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97)</span>\n<span class=\"token inserted\">+- [arch linux#brightness](https://wiki.archlinux.org/index.php/Backlight)</span>\n</code></pre></div>"}],"publishedAt":"2019-07-27","updatedAt":"2021-01-30"}},"__N_SSG":true}