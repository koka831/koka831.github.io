{"pageProps":{"post":{"slug":"2022_10_30_rust-tools-for-clippy","title":"clippyの開発でもrust-analyzerを使いたい","categories":["memo"],"image":"https://koka831.github.io/img/icon.png","tags":["Rust"],"content":"<p><a href=\"https://github.com/rust-lang/rust-clippy\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rust-clippy</a>はrustcのAPIを利用しており、<code>clippy</code>のソースコードを編集する際、デフォルトでは<a href=\"https://rust-analyzer.github.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rust-analyzer</a>の補完が効かない.\nそのため<code>rust-analyzer</code>に対し以下の設定が必要.</p>\n<div class=\"remark-highlight\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span> <span class=\"token property\">\"rust-analyzer.rustc.source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"discover\"</span> <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>これを<a href=\"https://github.com/simrat39/rust-tools.nvim\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rust-tools.nvim</a>で設定する方法が若干わかりづらかったのでメモ.</p>\n<h2 id=\"tldr\"><a href=\"#tldr\">TL;DR</a></h2>\n<p>結論、以下の様に<code>server</code>に対し<code>settings.[\"rust-analyzer\"]</code>を渡す.</p>\n<div class=\"remark-highlight\"><pre class=\"language-lua\"><code class=\"language-lua\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rust-tools'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  server <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    settings <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">\"rust-analyzer\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        rustc <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n          source <span class=\"token operator\">=</span> <span class=\"token string\">\"discover\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</code></pre></div>\n<hr>\n<p><code>rust-tools</code>の<a href=\"https://github.com/simrat39/rust-tools.nvim#configuration\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">#configuration</a>の項を見ると、<code>rust-analyzer</code>へのオプションを渡す<code>server</code>が用意されていることがわかる.</p>\n<div class=\"remark-highlight\"><pre data-file=\"rust-tools.nvim#configuration\" class=\"language-lua\"><code class=\"language-lua\"><span class=\"token comment\">-- all the opts to send to nvim-lspconfig</span>\n  <span class=\"token comment\">-- these override the defaults set by rust-tools.nvim</span>\n  <span class=\"token comment\">-- see <a href=\"https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#rust_analyzer\" class=\"token url-link\">https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#rust_analyzer</a></span>\n  server <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">-- standalone file support</span>\n    <span class=\"token comment\">-- setting it to false may improve startup time</span>\n    standalone <span class=\"token operator\">=</span> <span class=\"token keyword\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">-- rust-analyzer options</span>\n</code></pre></div>\n<blockquote>\n<p>all the opts to send to nvim-lspconfig</p>\n</blockquote>\n<p>とあるので、<code>nvim-lspconfig</code>での設定をそのまま<code>rust-tools</code>の<code>server</code>に記述すればよいのだが、当時の自分は\"そうは言っても<code>[\"rust-analyzer\"]</code>ディレクティブに渡すのだろう\"と思い込みんでいた.</p>","description":"rust-tools.nvim(nvim-lspconfig)でrust-clippyの開発時にrust-analyzerの補完を有効化するための設定方法","commits":[{"title":"add note","date":"2022-10-30 14:46:09","hash":"8733dd35","diff":"<div class=\"remark-highlight\"><pre data-file=\"8733dd35.patch\" class=\"language-git  language-diff\"><code class=\"language-git\"><span class=\"token commit-sha1\">commit 8733dd3554345ab4543ae9927dd51a40c1a89585</span>\nAuthor: koka &#x26;<a href=\"mailto:lt;koka.code@gmail.com\" class=\"token email-link\">lt;koka.code@gmail.com</a>&#x26;gt;\nDate:   Sun Oct 30 14:46:09 2022 +0900\n\n  add note\n\ndiff --git a/_posts/2022_10_30_rust-tools-for-clippy.md b/_posts/2022_10_30_rust-tools-for-clippy.md\nnew file mode 100644\nindex 0000000..c6142c3\n<span class=\"token deleted\">--- /dev/null</span>\n<span class=\"token inserted\">+++ b/_posts/2022_10_30_rust-tools-for-clippy.md</span>\n<span class=\"token coord\">@@ -0,0 +1,60 @@</span>\n<span class=\"token inserted\">+---</span>\n<span class=\"token inserted\">+title: clippyの開発でもrust-analyzerを使いたい</span>\n<span class=\"token inserted\">+date: 2022-10-30</span>\n<span class=\"token inserted\">+categories:</span>\n<span class=\"token inserted\">+- memo</span>\n<span class=\"token inserted\">+tags:</span>\n<span class=\"token inserted\">+- Rust</span>\n<span class=\"token inserted\">+description: rust-tools.nvim(nvim-lspconfig)でrust-clippyの開発時にrust-analyzerの補完を有効化するための設定方法</span>\n<span class=\"token inserted\">+---</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+[rust-clippy][clippy]はrustcのAPIを利用しており、`clippy`のソースコードを編集する際、デフォルトでは[rust-analyzer][analzer]の補完が効かない.</span>\n<span class=\"token inserted\">+そのため`rust-analyzer`に対し以下の設定が必要.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+\\```json</span>\n<span class=\"token inserted\">+{ \"rust-analyzer.rustc.source\": \"discover\" }</span>\n<span class=\"token inserted\">+\\```</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+これを[rust-tools.nvim][tools]で設定する方法が若干わかりづらかったのでメモ.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+## TL;DR</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+結論、以下の様に`server`に対し`settings.[\"rust-analyzer\"]`を渡す.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+\\```lua</span>\n<span class=\"token inserted\">+require('rust-tools').setup({</span>\n<span class=\"token inserted\">+  server = {</span>\n<span class=\"token inserted\">+    settings = {</span>\n<span class=\"token inserted\">+      [\"rust-analyzer\"] = {</span>\n<span class=\"token inserted\">+        rustc = {</span>\n<span class=\"token inserted\">+          source = \"discover\"</span>\n<span class=\"token inserted\">+        }</span>\n<span class=\"token inserted\">+      }</span>\n<span class=\"token inserted\">+    }</span>\n<span class=\"token inserted\">+  }</span>\n<span class=\"token inserted\">+})</span>\n<span class=\"token inserted\">+\\```</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+---</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+`rust-tools`の[#configuration][config]の項を見ると、`rust-analyzer`へのオプションを渡す`server`が用意されていることがわかる.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+\\```lua[data-file=\"rust-tools.nvim#configuration\"]</span>\n<span class=\"token inserted\">+  -- all the opts to send to nvim-lspconfig</span>\n<span class=\"token inserted\">+  -- these override the defaults set by rust-tools.nvim</span>\n<span class=\"token inserted\">+  -- see https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#rust_analyzer</span>\n<span class=\"token inserted\">+  server = {</span>\n<span class=\"token inserted\">+    -- standalone file support</span>\n<span class=\"token inserted\">+    -- setting it to false may improve startup time</span>\n<span class=\"token inserted\">+    standalone = true,</span>\n<span class=\"token inserted\">+  }, -- rust-analyzer options</span>\n<span class=\"token inserted\">+\\```</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+&#x26;gt; all the opts to send to nvim-lspconfig</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+とあるので、`nvim-lspconfig`での設定をそのまま`rust-tools`の`server`に記述すればよいのだが、当時の自分は\"そうは言っても`[\"rust-analyzer\"]`ディレクティブに渡すのだろう\"と思い込みんでいた.</span>\n<span class=\"token inserted\">+</span>\n<span class=\"token inserted\">+[clippy]: https://github.com/rust-lang/rust-clippy</span>\n<span class=\"token inserted\">+[analzer]: https://rust-analyzer.github.io/</span>\n<span class=\"token inserted\">+[tools]: https://github.com/simrat39/rust-tools.nvim</span>\n<span class=\"token inserted\">+[config]: https://github.com/simrat39/rust-tools.nvim#configuration</span>\n</code></pre></div>"}],"publishedAt":"2022-10-30","updatedAt":"2022-10-30"}},"__N_SSG":true}